# Flask XML Parser

Это приложение представляет собой микросервис, разработанный с использованием Flask и SQLite, который обрабатывает XML-файлы, сохраняет информацию о тегах и атрибутах в базе данных и предоставляет API для работы с ними. Приложение включает три основных эндпоинта для выполнения различных операций с XML-файлами.

## Как скопировать репозиторий

Чтобы склонировать репозиторий, выполните следующую команду:

```bash
git clone https://github.com/petrnaumenko/flask-xml-parser.git
cd flask-xml-parser
```

## Функциональность

### 1. /api/file/read
Этот метод отвечает за чтение XML-файлов, их валидацию и сохранение данных в базе данных. При успешном чтении файла, имя файла сохраняется в таблице `Files`, а теги и атрибуты сохраняются в таблицах `Tags` и `Attributes` соответственно. Метод возвращает `True` или `False`, в зависимости от результата выполнения. Связи между файлами, тегами и атрибутами выстраиваются с помощью внешних ключей.

- **Таблицы в базе данных**:
    - `Files`: хранит информацию о файлах (id, имя).
    - `Tags`: хранит информацию о тегах (id, имя, id файла).
    - `Attributes`: хранит информацию об атрибутах (id, имя, значение, id тега).

### 2. /api/tags/get-count
Этот эндпоинт принимает путь до XML-файла и название тега. Он возвращает количество вхождений указанного тега в файле. Если тег не найден, возвращается ошибка с сообщением: "В файле отсутствует тег с данным названием".

### 3. /api/tags/attributes/get
Этот эндпоинт принимает имя файла и название тега, а затем возвращает список всех уникальных атрибутов, которые присутствуют в заданном теге. Если несколько тегов имеют одинаковые атрибуты, они добавляются в список только один раз. Значения атрибутов не возвращаются, только имена атрибутов.

## Структура данных

- **Files**: таблица для хранения информации о файлах:
  ```sql
  CREATE TABLE Files (
      id INTEGER PRIMARY KEY,
      name TEXT
  );
  ```

- **Tags**: таблица для хранения информации о тегах:
  ```sql
  CREATE TABLE Tags (
      id INTEGER PRIMARY KEY,
      name TEXT,
      file_id INTEGER,
      FOREIGN KEY (file_id) REFERENCES Files(id)
  );
  ```

- **Attributes**: таблица для хранения информации об атрибутах тегов:
  ```sql
  CREATE TABLE Attributes (
      id INTEGER PRIMARY KEY,
      name TEXT,
      value TEXT,
      tag_id INTEGER,
      FOREIGN KEY (tag_id) REFERENCES Tags(id)
  );
  ```

## Тесты

Для тестирования функциональности используется набор тестов, который можно найти в папке `tests` проекта. В этой папке находится файл с тестовыми данными XML, который используется для проверки работы эндпоинтов. Тесты могут быть запущены с помощью команды:

```bash
pytest tests/
```

Тесты проверяют корректность работы API, включая сохранение данных в базе и правильность обработки запросов.

## Запуск приложения

Для запуска приложения и выполнения тестов в Docker можно использовать `docker-compose`:

1. Соберите и запустите контейнеры:
   ```bash
   docker-compose up --build
   ```

2. После того как контейнеры запустятся, вы можете проверять работоспособность API с помощью команд `curl`. Убедитесь, что вы находитесь в папке с приложением перед запуском команд `curl`:

   Пример команды для загрузки XML-файла:
   ```bash
   curl -X POST http://localhost:5000/api/file/read -F "file=@./tests/test.xml"
   ```

   Пример команды для получения количества тегов:
   ```bash
   curl -X GET "http://localhost:5000/api/tags/get-count?file_name=test.xml&tag_name=tag1"
   ```

   Пример команды для получения атрибутов тега:
   ```bash
   curl -X GET "http://localhost:5000/api/tags/attributes/get?file_name=test.xml&tag_name=tag1"
   ```

## Примечания

- **Тестовый XML файл**: Для тестирования используется тестовый XML файл, который находится в папке `tests`.
- **Ошибки подключения**: Если при выполнении команд `curl` возникает ошибка подключения, убедитесь, что приложение запущено и контейнеры Docker работают корректно.
